---
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import DefaultLayout from '../../layouts/DefaultLayout.astro';
import TagFilter from '../../components/TagFilter.astro';

// Get all posts and sort by date
const allPosts = (await getCollection('projects')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Count posts per tag and only include tags with more than one post
const tagCounts = allPosts
  .flatMap((post) => post.data.tags)
  .reduce(
    (acc, tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );

const allTags = Object.entries(tagCounts)
  .map(([tag]) => tag)
  .sort();

// Split into featured and other posts
const [featuredPost, ...otherPosts] = allPosts;

// Split other posts into those with and without images
const [postsWithImages, postsWithoutImages] = [
  otherPosts.slice(0, 4),
  otherPosts.slice(4),
];
---

<DefaultLayout 
  title="Projects" 
  description="A showcase of my latest projects and work"
>
  <section class="max-w-4xl mx-auto">
    <div class="mb-24">
      <div class="text-[1.125rem] max-w-3xl">
        <p class="text-gray-700 dark:text-gray-300 mb-6 leading-[1.75] tracking-[-0.01em]">
          A curated portfolio showcasing my work in frontend development, 
          user experience design, and software architecture. 
          From high-traffic web applications to 
          innovative side projects.
        </p>
      </div>
    </div>

    {featuredPost && (
      <div class="mb-24">
        <h2 class="text-[1.75rem] font-bold text-gray-900 dark:text-gray-100 tracking-tight mb-8">Featured Project</h2>
        <div class="space-y-3">
          <PostCard post={featuredPost} variant="featured" baseUrl='/projects/'/>
        </div>
      </div>
    )}

    <div class="mb-8">
      <h2 class="text-[1.75rem] font-bold text-gray-900 dark:text-gray-100 tracking-tight mb-8">More Projects</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16">
        {postsWithImages.map((post) => (
          <div class="space-y-3">
            <PostCard post={post} variant="default" baseUrl='/projects/'/>
          </div>
        ))}
        {postsWithoutImages.map((post) => (
          <div class="space-y-3">
            <PostCard post={post} variant="no-image" baseUrl='/projects/'/>
          </div>
        ))}
      </div>
    </div>
  </section>
</DefaultLayout>
