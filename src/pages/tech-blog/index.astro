---
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

// Get all posts and sort by date
const allPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Count posts per tag and only include tags with more than one post
const tagCounts = allPosts.flatMap(post => post.data.tags)
  .reduce((acc, tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
    return acc;
  }, {} as Record<string, number>);

const allTags = Object.entries(tagCounts)
  .map(([tag]) => tag)
  .sort();

// Split into featured and other posts
const [featuredPost, ...otherPosts] = allPosts;
---

<DefaultLayout 
  title="Tech Blog"
  description="Articles about software development, tech, and my experiences"
>
  <section class="max-w-7xl mx-auto">
    {featuredPost && (
      <div class="mb-16">
        <PostCard post={featuredPost} variant="featured" baseUrl='/tech-blog/'/>
      </div>
    )}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {otherPosts.map((post) => (
        <PostCard post={post} variant="compact"	baseUrl='/tech-blog/'/>
      ))}
    </div>
  </section>
</DefaultLayout>
