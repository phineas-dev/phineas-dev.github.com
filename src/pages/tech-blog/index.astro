---
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

// Get all posts and sort by date
const allPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Count posts per tag and only include tags with more than one post
const tagCounts = allPosts
  .flatMap((post) => post.data.tags)
  .reduce(
    (acc, tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );

const allTags = Object.entries(tagCounts)
  .map(([tag]) => tag)
  .sort();

// Split into featured and other posts
const [featuredPost, ...otherPosts] = allPosts;
---

<DefaultLayout 
  title="Tech Blog"
  description="Articles about software development, tech, and my experiences"
>
  <section class="max-w-7xl mx-auto">
    <div class="mb-16">
      <div class="prose dark:prose-invert mb-12">
        <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
          Articles and insights that I have written about software development, engineering practices, and web technologies, 
          with a focus on frontend development and modern architectural patterns.
        </p>
      </div>
    </div>

    {featuredPost && (
      <div class="mb-16">
        <h2 class="text-lg font-semibold mb-4 text-gray-500">Featured Post</h2>
        <PostCard post={featuredPost} variant="featured" baseUrl='/tech-blog/'/>
      </div>
    )}

    <h2 class="text-lg font-semibold mb-4 text-gray-500">More Posts</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {otherPosts.map((post) => (
        <PostCard post={post} variant="compact"	baseUrl='/tech-blog/'/>
      ))}
    </div>
  </section>
</DefaultLayout>
