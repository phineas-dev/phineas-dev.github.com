---
import BlendedImage from './BlendedImage.astro';
import FormattedDate from './FormattedDate.astro';
import Tag from './Tag.astro';
import type { Post } from '../content/types';

interface Props {
  post: Post;
  baseUrl: string;
  variant?: 'default' | 'featured' | 'compact' | 'no-image';
}

const { post, baseUrl, variant = 'default' } = Astro.props;
const { title, pubDate, description, tags } = post.data;

const containerClasses = {
  default: 'block',
  featured: 'mb-16',
  compact: '',
  'no-image': 'block',
}[variant];

const titleClasses = {
  default:
    'text-[1.125rem] font-semibold my-1 text-gray-900 dark:text-gray-100 group-hover:text-cyan-700 dark:group-hover:text-cyan-300 transition-all duration-300 tracking-tight',
  featured:
    'text-[2rem] font-bold mb-3 text-gray-900 dark:text-gray-100 group-hover:text-cyan-700 dark:group-hover:text-cyan-300 transition-all duration-300 tracking-tight leading-tight',
  compact:
    'text-[1.125rem] font-semibold m-0 leading-snug mb-4 group-hover:text-cyan-700 dark:group-hover:text-cyan-300 transition-all duration-300 tracking-tight',
  'no-image':
    'text-[1.125rem] font-semibold my-1 text-gray-900 dark:text-gray-100 group-hover:text-cyan-700 dark:group-hover:text-cyan-300 transition-all duration-300 tracking-tight',
}[variant];

const imageProps = {
  default: { aspectRatio: 40, hover: true },
  featured: { aspectRatio: 30, hover: true },
  compact: { hover: true },
  'no-image': null,
}[variant];

const descriptionClasses = {
  default:
    'text-gray-600 dark:text-gray-400 text-[0.9375rem] leading-[1.75] tracking-[-0.01em] line-clamp-2',
  featured:
    'text-gray-600 dark:text-gray-400 text-[1.0625rem] leading-[1.75] tracking-[-0.01em] line-clamp-3',
  compact: '',
  'no-image':
    'text-gray-600 dark:text-gray-400 text-[0.9375rem] leading-[1.75] tracking-[-0.01em] line-clamp-2',
}[variant];
---

<div class={containerClasses}>
  <a href={`${baseUrl}${post.slug}`} class="group block no-underline hover:opacity-95 transition-all duration-300">
    {imageProps && (
      <div class="mb-3">
        <BlendedImage 
          slug={post.slug}
          title={title}
          rounded={true}
          {...imageProps}
        />
      </div>
    )}
    <div class="space-y-1">
      <div class="text-[0.8125rem] font-medium text-gray-500 dark:text-gray-400 tracking-wide">
        <FormattedDate date={pubDate} />
      </div>
      <h2 class={titleClasses}>{title}</h2>
      {(variant === 'default' || variant === 'featured' || variant === 'no-image') && 
        <p class={descriptionClasses}>{description}</p>
      }
    </div>
  </a>
  {tags && tags.length > 0 && (
    <div class="flex flex-wrap gap-2 mt-4">
      {tags.filter(tag => tag && tag.length > 0).map(tag => (
        <Tag tag={tag} />
      ))}
    </div>
  )}
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
