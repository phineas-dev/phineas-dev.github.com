---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Markdown from '../components/Markdown.astro';
import PostTitle from '../components/PostTitle.astro';
import type { Post } from '../content/types';
import PostNavigation from '../components/PostNavigation.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import ReadingTime from '../components/ReadingTime.astro';
import SidebarNav from '../components/SidebarNav.astro';

type Props = Post['data'] & {
  slug: string;
  backText: string;
  baseUrl: string;
  prevPost: Post | null;
  nextPost: Post | null;
  headings?: { depth: number; slug: string; text: string }[];
  sections:  Array<{
    id: string;
    title: string;
  }>;
};

const {
  title,
  subtitle,
  description,
  pubDate,
  updatedDate,
  author,
  slug,
  color,
  backText,
  baseUrl,
  prevPost,
  nextPost,
  sections
} = Astro.props;

// Get raw content for reading time calculation
const rawContent = await Astro.slots.render('default');
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style is:global>
      .prose {
        padding: 1em;
      }
      .prose .title {
        margin-bottom: 1em;
        line-height: 1;
      }
      .prose .title h1 {
        margin: 0 0 0.5em 0;
      }
      .prose pre {
        overflow-x: auto;
      }
    </style>
  </head>

  <body class="bg-accent-light dark:bg-accent text-gray-950 dark:text-gray-50 antialiased transition-colors duration-300 min-h-screen flex flex-col">
    <ScrollProgress />
    <Header />
    
    <main class="flex-1 w-full p-8 container max-w-4xl mx-auto">
      <PostNavigation prevPost={prevPost} nextPost={nextPost} baseUrl={baseUrl} backText={backText} />
      
      <div class="relative flex justify-between gap-8">
        <SidebarNav sections={sections} />
        <article class="mx-auto max-w-3xl px-6 lg:px-0">
          <PostTitle title={title} subtitle={subtitle} pubDate={pubDate} updatedDate={updatedDate} author={author} slug={slug} color={color}>
            <ReadingTime content={rawContent} className="mt-2" />
          </PostTitle>
          <Markdown>
            <slot />
          </Markdown>
        </article>
      </div>

      <div class="py-8">
        <PostNavigation prevPost={prevPost} nextPost={nextPost} baseUrl={baseUrl} backText={backText} />
      </div>
    </main>

    <Footer />
  </body>
</html>
