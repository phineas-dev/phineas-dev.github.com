---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Markdown from '../components/Markdown.astro';
import PostTitle from '../components/PostTitle.astro';
import type { Post } from '../content/types';
import PostNavigation from '../components/PostNavigation.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import ReadingTime from '../components/ReadingTime.astro';
import TableOfContents from '../components/TableOfContents.astro';

type Props = Post['data'] & {
  slug: string;
  color: string;
  backText: string;
  baseUrl: string;
  prevPost: Post | null;
  nextPost: Post | null;
  headings?: { depth: number; slug: string; text: string }[];
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  author,
  slug,
  color,
  backText,
  baseUrl,
  prevPost,
  nextPost,
  headings = [],
} = Astro.props;

// Get raw content for reading time calculation
const rawContent = await Astro.slots.render('default');
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style is:global>
      .prose {
        padding: 1em;
      }
      .prose .title {
        margin-bottom: 1em;
        line-height: 1;
      }
      .prose .title h1 {
        margin: 0 0 0.5em 0;
      }
      .prose pre {
        overflow-x: auto;
      }
    </style>
  </head>

  <body class="bg-white text-gray-950 dark:bg-black dark:text-gray-50 antialiased min-h-screen flex flex-col">
    <ScrollProgress />
    <Header />
    
    <main class="flex-1 w-full pt-8">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <PostNavigation prevPost={prevPost} nextPost={nextPost} baseUrl={baseUrl} backText={backText} />
        </div>
      </div>

      <article class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
          <PostTitle title={title} pubDate={pubDate} updatedDate={updatedDate} author={author} slug={slug} color={color}>
            <ReadingTime content={rawContent} className="mt-2" />
          </PostTitle>
        </div>

        <div class="relative flex justify-between gap-8">
          <div class="prose prose-cyan dark:prose-invert max-w-4xl mx-auto">
            <Markdown>
              <slot />
            </Markdown>
          </div>
        </div>
      </article>

      <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
          <PostNavigation prevPost={prevPost} nextPost={nextPost} baseUrl={baseUrl} backText={backText} />
        </div>
      </div>
    </main>

    <Footer />
  </body>
</html>
